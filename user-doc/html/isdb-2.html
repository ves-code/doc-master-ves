<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: ISDB: setting up a SAXS post processing and refinement calculation using MARTINI form factors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.6.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('isdb-2.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">ISDB: setting up a SAXS post processing and refinement calculation using MARTINI form factors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section author"><dt>Authors</dt><dd>Cristina Paissoni</dd></dl>
<h1><a class="anchor" id="isdb-2-aims"></a>
Aims</h1>
<p>This tutorial is thought to illustrate how it is possible to compute SAXS intensities from single PDB files or trajectories using PLUMED. In particular, we will show how to compute scattering intensities with the hybrid coarse-grained/atomistic approach that is described in <a class="el" href="citelist.html#CITEREF_Paissoni:2019ee">[82]</a> . The tutorial will provide basic instructions to prepare files for the back-calculation of SAXS intensities using the hybrid approach (this process is simplified by the possibility to use an ad-hoc python script). Further, it is explained how to adjust the plumed input file for specific purposes, e.g. to use SAXS data as restraints in MD simulations or to compare SAXS intensities computed with both the atomistic and the hybrid approach.</p>
<h1><a class="anchor" id="isdb-2-objectives"></a>
Objectives</h1>
<p>Once this tutorial is completed users will be able to:</p><ul>
<li>Calculate SAXS intensities using PLUMED from PDB files or trajectories.</li>
<li>Setup a Metainference simulations using SAXS intensities as restraints (to this aim, <a class="el" href="isdb-1.html">ISDB: setting up a Metadynamics Metainference simulation</a> is required as a prior condition)</li>
</ul>
<h1><a class="anchor" id="isdb-2-resources"></a>
Resources</h1>
<p>The <span style="background-color:yellow"><a href="tutorial-resources/isdb-2.tar.gz" style="font-weight:bold" style="color:green" download="isdb-2.tar.gz">TARBALL </a> </span> for this project contains the following files:</p><ul>
<li>martiniFormFactor_p2.py and martiniFormFactor_p3.py: two helpful python scripts to be used with python 2 or python 3, respectively. These are based on the martinize.py script (<a href="http://cgmartini.nl/index.php/tools2/proteins-and-bilayers/204-martinize">http://cgmartini.nl/index.php/tools2/proteins-and-bilayers/204-martinize</a>)</li>
<li>start.pdb and samplextc.xtc: PDB and trajectory files on which you can perform the calculations;</li>
<li>SASDAB7.dat: a file containing SAXS intensities, downloaded from the SASDB database <a class="el" href="citelist.html#CITEREF_Valentini:2015ki">[109]</a> .</li>
</ul>
<p>This tutorial has been tested on PLUMED version 2.5.1</p>
<h1><a class="anchor" id="isdb-2-intro"></a>
Introduction</h1>
<p>Calculations of Small-angle X-ray scattering (SAXS) intensities from a structure of N atoms could be extremely demanding from a computational perspective as it is an \(O(N^2)\) problem. This issue has limited the applicability of SAXS in numerous situations, including their use as restraints in combination with MD simulations. A strategy to reduce the cost of computing SAXS from atomic structure consists in using a coarse grain representation of the structure, represented as a collection of M beads with M&lt;N, each comprising a variable number of atoms. Niebling et al <a class="el" href="citelist.html#CITEREF_Niebling:2014jy">[80]</a> have previously derived the Martini beads form factors for proteins, showing how this approach can be almost 50 times faster than the standard SAXS calculation. More recently, Martini beads form factors for nucleic acids have been also derived and, together with the ones for proteins, have been implemented in PLUMED. Importantly, it has been shown that the computation of scattering intensities using these Martini form factors achieves a good accuracy, as compared to the atomistic ones, for ùëû values up to 0.45 √Ö-1.</p>
<p>The Martini form factors can be exploited within a hybrid multi-resolution strategy to speed up SAXS profiles calculations, both for the back-calculation of scattering intensities from atomistic PDB or trajectory files and for the inclusion of SAXS data as restraints in experimental-driven all-atom simulations (e.g. <a class="el" href="_m_e_t_a_i_n_f_e_r_e_n_c_e.html">METAINFERENCE</a>). This can be achieved using PLUMED, which computes on the fly the virtual position of the Martini beads from the atomistic 3D-structure and then uses the centres of mass of these beads, along with Martini form factors, to quickly back-calculate SAXS intensities.</p>
<h1><a class="anchor" id="isdb-2-comp1"></a>
Computing SAXS intensities with the hybrid coarse-grained/atomistic approach</h1>
<p>Given a PDB file, PLUMED is able to compute SAXS intensities for the molecule in the PDB and to compare these intensities with the experimental ones stored in a data file. It is possible to apply the same procedure to all the conformations visited during a MD trajectory. This is achieved by using the PLUMED <a class="el" href="driver.html">driver</a> utility and the <a class="el" href="_s_a_x_s.html">SAXS</a> variable of the ISDB module. While computing scattering intensities with a full atomistic representation is quite easy (see the <a class="el" href="_s_a_x_s.html">SAXS</a> keyword and later in this tutorial), in order to adopt the hybrid coarse-grained/atomistic approach a more elaborated procedure is needed, requiring the generation of few specific files to be used as input by <a class="el" href="driver.html">driver</a>. To facilitate this step, it is possible to use this script (martiniFormFactor_p2.py for python 2 or martiniFormFactor_p3.py for python 3) and type in the bash shell:</p>
<pre class="fragment">python martiniFormFactor_p3.py -f filepdb.pdb -dat filedat.dat [-unit Ang/nm -nq 15]
</pre><p>The input files are:</p><ul>
<li>filepdb.pdb: a PDB file containing the atomic coordinates of the molecule; in our case it is start.pdb. Note that only one model should be present in the PDB and an ENDMDL statement is expected to appear only at the end of the file. Further, if different chains are present, they are expected to be separated by a TER statement or named differently (this is true also for chain breaks, but it is generally not recommended to use broken molecules for these calculations). If the aim is to analyse a trr/xtc trajectories, the PDB should contain the same atoms of the trajectories and with the same order, including water molecules and ions (you can simply save a sample PDB from the xtc/trr and use it to generate the necessary files).</li>
<li>filedat.dat: a file containing the momentum transfer in the first column and the experimental SAXS intensities in the second, with the two columns separated by blanks or commas; in our case it is SASDAB7.dat. Further columns are accepted but they will not be considered. The momentum transfer is expected to be expressed in inverse Angstrom, if it is expressed in inverse nm you can use the option ‚Äú-unit nm‚Äù (note that this is needed in our case!). By default, the python script will select 15 equally separated q values, and the relative intensities, between the first and the last values of the file. If you want to change this default behaviour of the python script you can use the option ‚Äú-nq‚Äù to indicate the number of q values to consider. These values will be used by PLUMED to compute SAXS intensities for the selected momentum transfers and to compare them with the corresponding experimental values provided.</li>
</ul>
<p>The files generated in this step, to be used later as input for <a class="el" href="driver.html">driver</a>, are the following:</p><ul>
<li>aacg_template.pdb: a PDB file, which PLUMED uses as a template, in which the atomistic model provided (with the atoms renumbered in sequential order) is concatenated to the coarse-grained representation.</li>
<li>plumed_beads.dat: a file that instructs PLUMED about how to compute the centre of mass of each bead and that define a group of atoms (called ‚Äúmartini‚Äù) containing all the identified beads. These atoms are the ones that will be used later for the calculation of SAXS intensities (the atom group ‚Äúmartini‚Äù is indeed recalled in the SAXS keyword of the plumed.dat file). We suggest to always double-check this file, verifying that the lists of atoms in the last beads correspond to the actual Martini mapping.</li>
<li>plumed.dat: a file that tells PLUMED to compute the <a class="el" href="_c_e_n_t_e_r.html">CENTER</a> of each bead (achieved reading plumed_beads.dat), compute scattering intensities for the selected q-values using the hybrid coarse-grained/atomistic approach and, lastly, print some output files that could be useful for further statistics. We will see later how to modify this file to achieve different goals.</li>
</ul>
<p>The default files generated should be sufficient to post-process single PDB files or trajectories, by typing:</p>
<pre class="fragment">plumed driver --plumed plumed.dat --mf_pdb file.pdb
</pre><p> or </p><pre class="fragment">plumed driver --plumed plumed.dat --mf_xtc file.xtc
</pre><p>The output files generated by this step are:</p><ul>
<li>SAXSINT, containing the computed SAXS intensities. Each line of this file contains in the first column a time and in the following columns the scattering intensities for each of the selected q-values. If the file post-processed is a PDB there will be only one line with time 0. Otherwise, each line will correspond to a frame of the input trajectory (by default the time unit is 1.0, but you can set the desired time step using the option ‚Äú‚Äìtimestep‚Äù of PLUMED <a class="el" href="driver.html">driver</a>).</li>
<li>ST.SAXS, containing in the first column a time (as above) and in the following column the correlation between experimental and back-calculated SAXS intensities for the selected q-values.</li>
</ul>
<p>Let's see now the meaning of each line in plumed.dat and how it is possible to modify it for other purposes, e.g. to compare atomistic/coarse-grained scattering intensities and to perform Metainference simulations where SAXS data are used as restraints. Here is a sample of plumed.dat produced by the python script martiniFormFactor_p3.py:</p>
<pre class="fragment">
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> STRUCTURE=aacg_template.pdb

<span style="color:blue"># BEADS DEFINITION</span>
<a href="./_i_n_c_l_u_d_e.html" style="color:green">INCLUDE</a> FILE=plumed_beads.dat

<span style="color:blue"># SAXS</span>
<a href="./_s_a_x_s.html" style="color:green">SAXS</a> ...

        LABEL=saxsdata
        ATOMS=martini
        MARTINI

        <span style="color:blue"># You can use SCALEINT keyword to set appropriate scaling factor.</span>
        <span style="color:blue"># SCALEINT is expected to correspond to the intensity in q=0</span>
        <span style="color:blue"># SCALEINT=</span>

        QVALUE1=0.0111721000    EXPINT1=0.0527250000
        QVALUE2=0.0368675000    EXPINT2=0.0327126000
        QVALUE3=0.0625615000    EXPINT3=0.0128316000
        QVALUE4=0.0882529000    EXPINT4=0.0045545200
        QVALUE5=0.1139410000    EXPINT5=0.0022799600
        QVALUE6=0.1396240000    EXPINT6=0.0013048600
        QVALUE7=0.1653020000    EXPINT7=0.0007215740
        QVALUE8=0.1909730000    EXPINT8=0.0004340930
        QVALUE9=0.2166360000    EXPINT9=0.0002717150
        QVALUE10=0.2422910000   EXPINT10=0.0002574160
        QVALUE11=0.2679360000   EXPINT11=0.0001878030
        QVALUE12=0.2935700000   EXPINT12=0.0001592670
        QVALUE13=0.3191930000   EXPINT13=0.0000811279
        QVALUE14=0.3448030000   EXPINT14=0.0001110630
        QVALUE15=0.3703990000   EXPINT15=0.0001264680

        <span style="color:blue"># METAINFERENCE</span>
        <span style="color:blue"># Uncomment the following keywords and adjust parameters to activate METAINFERENCE</span>
        <span style="color:blue"># DOSCORE NOENSEMBLE SIGMA_MEAN0=0</span>
        <span style="color:blue"># REGRES_ZERO=500</span>
        <span style="color:blue"># SIGMA0=5 SIGMA_MIN=0.001 SIGMA_MAX=5.00</span>
        <span style="color:blue"># NOISETYPE=MGAUSS</span>

... SAXS

<span style="color:blue"># METAINFERENCE</span>
<span style="color:blue"># Uncomment the following keyword to activate METAINF</span>
<span style="color:blue"># saxsbias: BIASVALUE ARG=(saxsdata\.score) STRIDE=10</span>

<span style="color:blue"># STATISTICS</span>
statcg: <a href="./_s_t_a_t_s.html" style="color:green">STATS</a> ARG=(saxsdata\.q_.*) PARARG=(saxsdata\.exp_.*)

<span style="color:blue"># PRINT</span>
<span style="color:blue"># Uncomment the following line to print METAINFERENCE output</span>
<span style="color:blue"># PRINT ARG=(saxsdata\.score),(saxsdata\.biasDer),(saxsdata\.weight),(saxsdata\.scale),  (saxsdata\.offset),(saxsdata\.acceptSigma),(saxsdata\.sigma.*) STRIDE=500 FILE=BAYES.SAXS</span>
<span style="color:blue"># change stride if you are using METAINFERENCE</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=(saxsdata\.q_.*) STRIDE=1 FILE=SAXSINT
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=statcg.corr STRIDE=1 FILE=ST.SAXSCG
</pre><p>The first two lines tell PLUMED to use aacg_template.pdb as a template and to read the file plumed_beads.dat (which rules how to compute the <a class="el" href="_c_e_n_t_e_r.html">CENTER</a> of the beads and defines the ‚Äúmartini‚Äù group, containing all the beads). Note that you do not need to prepare these two files, since they both are produced by the python script martiniFormFactor_p[2,3].py. These lines are followed by the SAXS keyword, labelled ‚Äúsaxsdata‚Äù. Here are defined the atoms to be used for SAXS calculations (in our case these are all the beads within the group ‚Äúmartini‚Äù) and the structure factors to adopt: in this case we are using the Martini form factors (flag MARTINI), alternatively it is possible to use the atomistic ones (flag ATOMISTIC) or define custom form factors using a polynomial expansion to any order (flag PARAMETERS). By default, PLUMED computes a scaling factor to fit experimental and back-calculated intensities, however it is possible to set manually this scaling factor using the flag SCALEINT, which is expected to correspond to the intensity in q=0. The following lines indicate the q-values at which the calculation of scattering intensities is required (QVALUE) and the corresponding intensities (EXPINT). These are the ones selected by default by the python script, but it is possible to manually adjust them and/or to add new values. Lastly, within the SAXS keyword, there are few lines that are needed to activate <a class="el" href="_m_e_t_a_i_n_f_e_r_e_n_c_e.html">METAINFERENCE</a>. These are commented since they are not necessary for the back-calculation of SAXS intensities, however you have to uncomment and adjust them if you want to perform Metainference simulations in which SAXS data are used as restraints. The same is true for the line containing the keyword BIASVALUE. In the last part of the file, we ask PLUMED to compute some statistics comparing experimental and back-calculated intensities; finally, we print the computed intensities and statistics into the SAXSINT and ST.SAXSCG files, respectively.</p>
<p>It is easy to modify the plumed.dat for your own purposes, for instance:</p><ol type="1">
<li>it could be used to perform Metainference simulations: to this aim it is sufficient to uncomment the lines indicated in the plumed.dat above and adjust the parameters to make them suitable for the investigated system (see the tutorial ISDB: setting up a Metadynamics Metainference simulation and the SAXS keyword). We further suggest adding (if needed) <a class="el" href="_w_h_o_l_e_m_o_l_e_c_u_l_e_s.html">WHOLEMOLECULES</a> and NOPBC flags.</li>
<li>it could be exploited to compute SAXS intensities with both the atomistic and the hybrid approach to compare them later. A sample plumed.dat to achieve this could be:</li>
</ol>
<pre class="fragment">
<a href="./_m_o_l_i_n_f_o.html" style="color:green">MOLINFO</a> STRUCTURE=aacg_template.pdb
<span style="color:blue"># BEADS DEFINITION</span>
<a href="./_i_n_c_l_u_d_e.html" style="color:green">INCLUDE</a> FILE=plumed_beads.dat

<span style="color:blue"># SAXS</span>
<a href="./_s_a_x_s.html" style="color:green">SAXS</a> ...
LABEL=saxscg
ATOMS=martini
MARTINI 
QVALUE1=0.010
QVALUE2=0.020
<span style="color:blue"># etc..</span>
... SAXS

<a href="./_s_a_x_s.html" style="color:green">SAXS</a> ...
LABEL=saxsaa
ATOMS=1-11104
      ATOMISTIC
QVALUE1=0.010
QVALUE2=0.020
<span style="color:blue"># etc..</span>
... SAXS

<span style="color:blue">#PRINT</span>
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=(saxscg\.q_.*) FILE=QVAL_CG
<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=(saxsaa\.q_.*) FILE=QVAL_AA
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_add_mod.html">Additional Modules</a></li><li class="navelem"><a class="el" href="_i_s_d_b.html">PLUMED-ISDB</a></li><li class="navelem"><a class="el" href="_i_s_d_b_tutorial.html">Tutorials</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
