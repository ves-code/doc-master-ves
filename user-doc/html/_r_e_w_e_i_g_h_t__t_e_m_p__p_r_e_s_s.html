<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>PLUMED: REWEIGHT_TEMP_PRESS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table align="center" frame="void" width="98%" cellpadding="2%">
<tbody>
<tr style="height: 30px;">
<td valign="center"> &nbsp; <img src="pigeon.png" width="120"/></td>
<td style="padding-left: 0.2em;" width="74%"> <a href="http://www.plumed.org"> <img src="logo.png" width="400" /> </td>
<td style="padding-left: 0.2em;" align="right"> <a href="../../developer-doc/html/index.html"> <img src="user-logo.png" width="180" /> </a> </td>
</tr>
</tbody>
</table>
<!--
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">PLUMED
   &#160;<span id="projectnumber">2.6.0-dev</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
-->
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_r_e_w_e_i_g_h_t__t_e_m_p__p_r_e_s_s.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">REWEIGHT_TEMP_PRESS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table align="center" frame="void" width="95%%" celpadding="5%%">
<tr>
<td width="70%%"></td><td><b> This is part of the bias <a class="el" href="mymodules.html">module </a></b>   </td></tr>
</table>
<p>Calculate weights for ensemble averages at temperatures and/or pressures different than those used in your original simulation.</p>
<p>We can use our knowledge of the probability distribution in the canonical (N \(\mathcal{V}\)T) or the isothermal-isobaric ensemble (NPT) to reweight the data contained in trajectories and obtain ensemble averages at different temperatures and/or pressures.</p>
<p>Consider the ensemble average of an observable \(O(\mathbf{R},\mathcal{V})\) that depends on the atomic coordinates \(\mathbf{R}\) and the volume \(\mathcal{V}\). This observable is in practice any collective variable (CV) calculated by Plumed. The ensemble average of the observable in an ensemble \( \xi&#39; \) can be calculated from a simulation performed in an ensemble \( \xi \) using: </p><p class="formulaDsp">
\[ \langle O(\mathbf{R},\mathcal{V}) \rangle_{\xi&#39;} = \frac{\langle O(\mathbf{R},\mathcal{V}) w(\mathbf{R},\mathcal{V}) \rangle_{\xi}} {\langle w(\mathbf{R},\mathcal{V}) \rangle_{\xi}} \]
</p>
<p> where \(\langle \cdot \rangle_{\xi}\) and \(\langle \cdot \rangle_{\xi&#39;}\) are mean values in the simulated and targeted ensemble, respectively, \( E(\mathbf{R}) \) is the potential energy of the system, and \( w (\mathbf{R},\mathcal{V}) \) are the appropriate weights to take from \( \xi \) to \( \xi&#39; \). This action calculates the weights \( w (\mathbf{R},\mathcal{V}) \) and handles 4 different cases:</p><ol type="1">
<li>Change of temperature from T to T' at constant volume. That is to say, from a simulation performed in the N \(\mathcal{V}\)T (canonical) ensemble, obtain an ensemble average in the N \(\mathcal{V}\)T' ensemble. The weights in this case are \( w(\mathbf{R},\mathcal{V}) = e^{(\beta-\beta&#39;)E(\mathbf{R})} \) with \( \beta \) and \( \beta&#39; \) the inverse temperatures.</li>
<li>Change of temperature from T to T' at constant pressure. That is to say, from a simulation performed in the NPT (isothermal-isobaric) ensemble, obtain an ensemble average in the NPT' ensemble. The weights in this case are \( w(\mathbf{R},\mathcal{V}) = e^{(\beta-\beta&#39;)(E(\mathbf{R}) + P\mathcal{V}) } \).</li>
<li>Change of pressure from P to P' at constant temperature. That is to say, from a simulation performed in the NPT (isothermal-isobaric) ensemble, obtain an ensemble average in the NP'T ensemble. The weights in this case are \( w(\mathbf{R},\mathcal{V}) = e^{\beta (P - P&#39;) \mathcal{V}} \).</li>
<li>Change of temperature and pressure from T,P to T',P'. That is to say, from a simulation performed in the NPT (isothermal-isobaric) ensemble, obtain an ensemble average in the NP'T' ensemble. The weights in this case are \( w(\mathbf{R},\mathcal{V}) = e^{(\beta-\beta&#39;)E(\mathbf{R}) + (\beta P - \beta&#39; P&#39;) \mathcal{V}} \).</li>
</ol>
<p>These weights can be used in any action that computes ensemble averages. For example this action can be used in tandem with <a class="el" href="_h_i_s_t_o_g_r_a_m.html">HISTOGRAM</a> or <a class="el" href="_a_v_e_r_a_g_e.html">AVERAGE</a>.</p>
<p>The above equation is often impractical since the overlap between the distributions of energy and volume at different temperatures and pressures is only significant for neighboring temperatures and pressures. For this reason an unbiased simulation is of little use to reweight at different temperatures and/or pressures. A successful approach has been altering the probability of observing a configuration in order to increase this overlap <a class="el" href="citelist.html#CITEREF_wanglandau">[113]</a>. This is done through a bias potential \( V(\mathbf{s}) \) where \( \mathbf{s} \) is a set of CVs, that often is the energy (and possibly the volume). In order to calculate ensemble averages, also the effect of this bias must be taken into account. The ensemble average of the observable in the ensemble \( \xi&#39; \) can be calculated from a biased simulation performed in the ensemble \(\xi\) with bias \( V(\mathbf{s}) \) using: </p><p class="formulaDsp">
\[ \langle O(\mathbf{R},\mathcal{V}) \rangle_{\xi&#39;} = \frac{\langle O(\mathbf{R},\mathcal{V}) w (\mathbf{R},\mathcal{V}) e^{\beta V(\mathbf{s})} \rangle_{\xi,V}} {\langle w (\mathbf{R},\mathcal{V}) e^{\beta V(\mathbf{s})} \rangle_{\xi,V}} \]
</p>
<p> where \(\langle \cdot \rangle_{\xi,V}\) is a mean value in the biased ensemble with static bias \( V(\mathbf{s}) \). Therefore in order to reweight the trajectory at different temperatures and/or pressures one must use the weights calculated by this action \( w (\mathbf{R},\mathcal{V}) \) together with the weights of <a class="el" href="_r_e_w_e_i_g_h_t__b_i_a_s.html">REWEIGHT_BIAS</a> (see the examples below).</p>
<p>The bias potential \( V(\mathbf{s}) \) can be constructed with <a class="el" href="_m_e_t_a_d.html">METAD</a> using <a class="el" href="_e_n_e_r_g_y.html">ENERGY</a> as a CV <a class="el" href="citelist.html#CITEREF_mich+04prl">[75]</a>. More specialized tools are available, for instance using bespoke target distributions such as <a class="el" href="_t_d__m_u_l_t_i_c_a_n_o_n_i_c_a_l.html">TD_MULTICANONICAL</a> and <a class="el" href="_t_d__m_u_l_t_i_t_h_e_r_m_a_l__m_u_l_t_i_b_a_r_i_c.html">TD_MULTITHERMAL_MULTIBARIC</a> <a class="el" href="citelist.html#CITEREF_Piaggi-PRL-2019">[86]</a> <a class="el" href="citelist.html#CITEREF_Piaggi-arXiv-2019">[87]</a> within <a class="el" href="_v_e_s.html">Variationally Enhanced Sampling (VES code)</a>. In the latter algorithms the interval of temperatures and pressures in which the trajectory can be reweighted is chosen explicitly.</p>
<dl class="section user"><dt>Options</dt><dd></dd></dl>
<table align="center" frame="void" width="95%%" cellpadding="5%%">
<tr>
<td width="15%"><b> TEMP </b> </td><td>the system temperature. This is not required if your MD code passes this quantity to PLUMED   </td></tr>
<tr>
<td width="15%"><b> ENERGY </b> </td><td>Energy   </td></tr>
<tr>
<td width="15%"><b> VOLUME </b> </td><td>Volume   </td></tr>
<tr>
<td width="15%"><b> REWEIGHT_PRESSURE </b> </td><td>Reweighting pressure   </td></tr>
<tr>
<td width="15%"><b> PRESSURE </b> </td><td>The system pressure   </td></tr>
<tr>
<td width="15%"><b> REWEIGHT_TEMP </b> </td><td>Reweighting temperature   </td></tr>
</table>
<dl class="section user"><dt>Examples</dt><dd></dd></dl>
<p>We consider the 4 cases described above.</p>
<p>The following input can be used to postprocess a molecular dynamics trajectory of a system of 1000 particles run at 500 K and constant volume using a static bias potential. We read from a file COLVAR the potential energy, a distance, and the value of the bias potential and calculate the ensemble average of the distance at 300 K.</p>
<pre class="fragment">
energy: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=energy  IGNORE_TIME
distance: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=distance  IGNORE_TIME
mybias: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=mybias.bias  IGNORE_TIME

<span style="color:blue"># Shift energy (to avoid numerical issues)</span>
renergy: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=energy PARAMETERS=-13250 PERIODIC=NO

<span style="color:blue"># Weights</span>
bias_weights: <a href="./_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> TEMP=500 ARG=mybias.bias
temp_press_weights: <a href="./_r_e_w_e_i_g_h_t__t_e_m_p__p_r_e_s_s.html" style="color:green">REWEIGHT_TEMP_PRESS</a> TEMP=500 REWEIGHT_TEMP=300 ENERGY=renergy

<span style="color:blue"># Ensemble average of the distance at 300 K</span>
avg_dist: <a href="./_a_v_e_r_a_g_e.html" style="color:green">AVERAGE</a> ARG=distance LOGWEIGHTS=bias_weights,temp_press_weights

<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=avg_dist FILE=COLVAR_REWEIGHT STRIDE=1
</pre><p>The next three inputs can be used to postprocess a molecular dynamics trajectory of a system of 1000 particles run at 500 K and 1 bar using a static bias potential.</p>
<p>We read from a file COLVAR the potential energy, the volume, and the value of the bias potential and calculate the ensemble average of the (particle) density at 300 K and 1 bar (the simulation temperature was 500 K).</p>
<pre class="fragment">
energy: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=energy  IGNORE_TIME
volume: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=volume  IGNORE_TIME
mybias: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=mybias.bias  IGNORE_TIME

<span style="color:blue"># Shift energy and volume (to avoid numerical issues)</span>
rvol: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=vol PARAMETERS=7.8 PERIODIC=NO
renergy: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=energy PARAMETERS=-13250 PERIODIC=NO

<span style="color:blue"># Weights</span>
bias_weights: <a href="./_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> TEMP=500 ARG=mybias.bias
temp_press_weights: <a href="./_r_e_w_e_i_g_h_t__t_e_m_p__p_r_e_s_s.html" style="color:green">REWEIGHT_TEMP_PRESS</a> TEMP=500 REWEIGHT_TEMP=300 PRESSURE=0.06022140857 ENERGY=renergy VOLUME=rvolume

<span style="color:blue"># Ensemble average of the volume at 300 K</span>
avg_vol: <a href="./_a_v_e_r_a_g_e.html" style="color:green">AVERAGE</a> ARG=volume LOGWEIGHTS=bias_weights,temp_press_weights
<span style="color:blue"># Ensemble average of the density at 300 K</span>
avg_density: <a href="./_c_u_s_t_o_m.html" style="color:green">CUSTOM</a> ARG=avg_vol FUNC=1000/x PERIODIC=NO

<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=avg_density FILE=COLVAR_REWEIGHT STRIDE=1
</pre><p>In the next example we calculate the ensemble average of the (particle) density at 500 K and 300 MPa (the simulation pressure was 1 bar).</p>
<pre class="fragment">
volume: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=volume  IGNORE_TIME
mybias: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=mybias.bias  IGNORE_TIME

<span style="color:blue"># Shift volume (to avoid numerical issues)</span>
rvol: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=vol PARAMETERS=7.8 PERIODIC=NO

<span style="color:blue"># Weights</span>
bias_weights: <a href="./_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> TEMP=500 ARG=mybias.bias
temp_press_weights: <a href="./_r_e_w_e_i_g_h_t__t_e_m_p__p_r_e_s_s.html" style="color:green">REWEIGHT_TEMP_PRESS</a> TEMP=500 PRESSURE=0.06022140857 REWEIGHT_PRESSURE=180.66422571 VOLUME=volume

<span style="color:blue"># Ensemble average of the volume at 300 K and 300 MPa</span>
avg_vol: <a href="./_a_v_e_r_a_g_e.html" style="color:green">AVERAGE</a> ARG=volume LOGWEIGHTS=bias_weights,temp_press_weights
<span style="color:blue"># Ensemble average of the density at 300 K and 300 MPa</span>
avg_density: <a href="./_c_u_s_t_o_m.html" style="color:green">CUSTOM</a> ARG=avg_vol FUNC=1000/x PERIODIC=NO

<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=avg_density FILE=COLVAR_REWEIGHT STRIDE=1
</pre><p>In this final example we calculate the ensemble average of the (particle) density at 300 K and 300 MPa (the simulation temperature and pressure were 500 K and 1 bar).</p>
<pre class="fragment">
energy: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=energy  IGNORE_TIME
volume: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=volume  IGNORE_TIME
mybias: <a href="./_r_e_a_d.html" style="color:green">READ</a> FILE=COLVAR VALUES=mybias.bias  IGNORE_TIME

<span style="color:blue"># Shift energy and volume (to avoid numerical issues)</span>
rvol: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=vol PARAMETERS=7.8 PERIODIC=NO
renergy: <a href="./_c_o_m_b_i_n_e.html" style="color:green">COMBINE</a> ARG=energy PARAMETERS=-13250 PERIODIC=NO

<span style="color:blue"># Weights</span>
bias_weights: <a href="./_r_e_w_e_i_g_h_t__b_i_a_s.html" style="color:green">REWEIGHT_BIAS</a> TEMP=500 ARG=mybias.bias
temp_press_weights: <a href="./_r_e_w_e_i_g_h_t__t_e_m_p__p_r_e_s_s.html" style="color:green">REWEIGHT_TEMP_PRESS</a> TEMP=500 REWEIGHT_TEMP=300 PRESSURE=0.06022140857 REWEIGHT_PRESSURE=180.66422571 ENERGY=renergy VOLUME=rvolume

<span style="color:blue"># Ensemble average of the volume at 300 K and 300 MPa</span>
avg_vol: <a href="./_a_v_e_r_a_g_e.html" style="color:green">AVERAGE</a> ARG=volume LOGWEIGHTS=bias_weights,temp_press_weights
<span style="color:blue"># Ensemble average of the density at 300 K and 300 MPa</span>
avg_density: <a href="./_c_u_s_t_o_m.html" style="color:green">CUSTOM</a> ARG=avg_vol FUNC=1000/x PERIODIC=NO

<a href="./_p_r_i_n_t.html" style="color:green">PRINT</a> ARG=avg_density FILE=COLVAR_REWEIGHT STRIDE=1
</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
<!--    <li class="navelem"><a class="el" href="_analysis.html">Analysis</a></li>  -->
    <li class="footer">   <!--- Generated by -->
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
